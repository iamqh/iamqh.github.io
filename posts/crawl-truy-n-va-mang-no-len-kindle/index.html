<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Crawl truyện và mang nó lên Kindle | iamqh's Blog</title>
<meta name=keywords content="python,crawl">
<meta name=description content="Chuyện là đợt dính covid vừa rồi phải cách ly một mình một cõi, mình mới nhận ra là mình còn sở hữu một em kindle paper white đời thứ 3 vẫn còn ngon. Hồi đấy mua về để đọc truyện mà sau lại lười quá, vứt xó rồi quên luôn :sweat_smile:. Cách ly chán quá, nên mình có thời gian đọc cày xong Kimetsu no yaiba luôn. Rảnh thật đấy :relieved:.">
<meta name=author content="iamqh">
<link rel=canonical href=https://iamqh.github.io/posts/crawl-truy-n-va-mang-no-len-kindle/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.b161e3811ba513bf5e9f9dafc2073466d293153f34aaa61b83dff97fac59a2e4.css integrity="sha256-sWHjgRulE79en52vwgc0ZtKTFT80qqYbg9/5f6xZouQ=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://iamqh.github.io/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://iamqh.github.io/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://iamqh.github.io/favicon-32x32.png>
<link rel=emoji type=image/png href=/img/sheet_messenger_64_indexed_128.png>
<link rel=apple-touch-icon href=https://iamqh.github.io/apple-touch-icon.png>
<link rel=mask-icon href=https://iamqh.github.io/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<link rel=manifest href=/manifest.json>
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css integrity=sha384-KiWOvVjnN8qwAZbuQyWDIbfCLFhLXNETzBQjA/92pIowpC0d2O3nppDGQVgwd2nB crossorigin=anonymous>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js integrity=sha384-0fdwu/T/EQMsQlrHCCHoH10pkPLlKA1jL5dFyUOvB3lfeT2540/2g6YgSi2BL14p crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous onload=renderMathInElement(document.body)></script>
<meta property="og:title" content="Crawl truyện và mang nó lên Kindle">
<meta property="og:description" content="Chuyện là đợt dính covid vừa rồi phải cách ly một mình một cõi, mình mới nhận ra là mình còn sở hữu một em kindle paper white đời thứ 3 vẫn còn ngon. Hồi đấy mua về để đọc truyện mà sau lại lười quá, vứt xó rồi quên luôn :sweat_smile:. Cách ly chán quá, nên mình có thời gian đọc cày xong Kimetsu no yaiba luôn. Rảnh thật đấy :relieved:.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://iamqh.github.io/posts/crawl-truy-n-va-mang-no-len-kindle/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-04-28T17:00:00+00:00">
<meta property="article:modified_time" content="2022-04-28T17:00:00+00:00"><meta property="og:site_name" content="iamqh's Blog">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Crawl truyện và mang nó lên Kindle">
<meta name=twitter:description content="Chuyện là đợt dính covid vừa rồi phải cách ly một mình một cõi, mình mới nhận ra là mình còn sở hữu một em kindle paper white đời thứ 3 vẫn còn ngon. Hồi đấy mua về để đọc truyện mà sau lại lười quá, vứt xó rồi quên luôn :sweat_smile:. Cách ly chán quá, nên mình có thời gian đọc cày xong Kimetsu no yaiba luôn. Rảnh thật đấy :relieved:.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://iamqh.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Crawl truyện và mang nó lên Kindle","item":"https://iamqh.github.io/posts/crawl-truy-n-va-mang-no-len-kindle/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Crawl truyện và mang nó lên Kindle","name":"Crawl truyện và mang nó lên Kindle","description":"Chuyện là đợt dính covid vừa rồi phải cách ly một mình một cõi, mình mới nhận ra là mình còn sở hữu một em kindle paper white đời thứ 3 vẫn còn ngon. Hồi đấy mua về để đọc truyện mà sau lại lười quá, vứt xó rồi quên luôn :sweat_smile:. Cách ly chán quá, nên mình có thời gian đọc cày xong Kimetsu no yaiba luôn. Rảnh thật đấy :relieved:.","keywords":["python","crawl"],"articleBody":"Chuyện là đợt dính covid vừa rồi phải cách ly một mình một cõi, mình mới nhận ra là mình còn sở hữu một em kindle paper white đời thứ 3 vẫn còn ngon. Hồi đấy mua về để đọc truyện mà sau lại lười quá, vứt xó rồi quên luôn :sweat_smile:. Cách ly chán quá, nên mình có thời gian đọc cày xong Kimetsu no yaiba luôn. Rảnh thật đấy :relieved:. Mấy hôm nay thì mình có đọc tiếp Conan, bác tác giả ra chap mới lâu thiệt chứ. Thế là tình cờ phát hiện ra một trang truyện dịch lại những quyển tiêu thuyết (không phải là manga nha). Cơ mà đọc trên kindle quen rồi, đọc trên máy điện thoại hay tablet mình thấy khó tập trung hơn. Nên mình quyết định thử chuyển mấy cuốn truyện đó lên Kindle được hay không!\nCrawl data Okay, let’s start! Trước hết thì trang web mình tìm được là Truyện dịch. Như các bạn đã thấy, trang web đã có đầy đủ các thông tin cơ bản của 1 ebook như cover, tác giả, lời giới thiệu và mục lục.\nBây giờ chúng ta cùng vào xem thử một chương của tiểu thuyết xem sao. May quá, toàn bộ đều chỉ là html bình thường, không phải load js gì cả. Vậy thì việc crawl data sẽ không gặp khó khăn gì cả! Mình sẽ sử dụng python kết hợp với lxml để crawl thôi. Sau khi trích xuất được content của từng chapter, mình sẽ lưu nó lại thành từng file markdown tương ứng với từng chapter. Còn tại sao lại là markdown thì phần sau sẽ rõ\ndef _getChapter(self, number: int, url: str): file_name = 'chapter-{0}.md'.format(number) html_text = self.session.get(url).text tree = etree.HTML(html_text) content_node = tree.xpath('//div[@id=\"read-content\"]')[0] chapter_html = etree.tostring(content_node) file = os.path.join(self.save_path, file_name) with open(file, \"w\", encoding='utf-8') as text_file: markdown_text = md(chapter_html) markdown_text = markdown_text.replace(' - ', ' \\- ') text_file.write(markdown_text) Tạo ebook Mình rất là khó chịu với việc đọc phải ebook nào mà không có mục lục, khi đó để xem mình đang đọc đến đâu hoặc là chọn nhanh 1 chương là gần như không thể. Vì vậy mình tách mỗi chapter thành 1 file markdown, và dùng MarkdownPP để gắn chúng lại với nhau.\nwith open(input_name, 'w', encoding='utf-8') as template: template.writelines(['% {0}'.format(novel.title),'\\n', '% {0}'.format(novel.author), '\\n\\n']) for chapter in chapters: template.write('## {0}\\n\\n'.format(chapter.title)) template.write('!INCLUDE \"{0}/{1}\", 1\\n\\n'.format(self.save_path, chapter.file_name)) template.close() input = open(input_name, 'r') output = open(output_name, 'w') MarkdownPP.MarkdownPP(input=input, output=output, modules=list(MarkdownPP.modules)) input.close() output.close() Như các bạn thấy ở trên, trc khi thêm từng chapter, mình đều để 1 heading, điều này sẽ giúp chúng ta dễ dàng trong bước tạo ebook này.\nOkay, vậy là đã tạo được 1 ebook “tạm đọc được”. Giờ mình sẽ dùng pandoc để chuyển markdown sang ebook định dạng epub.\nLàm cái này mình mới nhận ra là làm ebook cũng style bằng css. Tất nhiên là nó không đến mức phức tạp như web, chỉ là style 1 vài tag cơ bản thôi. Ví dụ như style dưới đây\nbody { font-family: Georgia,\"Times New Roman\",Times; margin: 5%; text-align: justify; font-size: medium; } code { font-family: monospace; } section h1 { text-align: left; font-size: 4.5em; font-weight: bold; margin-bottom: 0; padding-bottom: 0; font-style: italic; } h1 + p { margin-top: 0; padding-top: 0; } h2 { text-align: left; font-size: 1.5em; } h3 { text-align: left; font-size: 1em; font-weight: bold; } h4 { text-align: left; } h5 { text-align: left; } h6 { text-align: left; } h1.title { text-align: left; font-size: 2em; margin-top: 50%; } h2.author { font-size: 1.3em; } h3.date { } div.title h1 { text-align: left; font-size: 2em; margin-top: 50%; } ol.toc { padding: 0; margin-left: 1em; } ol.toc li { list-style-type: none; margin: 0; padding: 0; } hr { border: none; text-align: center; } hr:after { content: '* * *'; } #toc  ol  li  a { display: none; } #the-night-alphabet blockquote { margin-top: 50%; font-style: italic; } #the-night-alphabet h1 { text-align: center; font-size: 4em; page-break-after: always; } Sau khi style xong thì mình build ebook thôi\noutput = open(output_name, 'r') doc = pandoc.read(file=output) pandoc.write(doc=doc, file='{0}.epub'.format(slug), format='epub', options=['--css=style.css']) output.close() Cuối cùng là vứt nó lên kindle bằng cách gửi qua mail mình đã đăng kí. Và đây là thành quả\nKết Đây là toàn bộ source code mà mình đã dùng để crawl và chuyển sang epub. Các bạn có thể tham khảo tại repo này.\nCòn rất nhiều điều có thể làm tiếp tại dự án này, như là thêm ảnh cover cho ebook, tạo extension cho chrome để có thể download trực tiếp từ trang web hoặc tạo 1 con web riêng để mọi người có thể điền link vào và tải về, vân vân và mây mây…\nXin cảm ơn các bạn đã kiên nhẫn đọc đến tận đây (tui nói vậy thôi chứ tui biết bạn scroll xuống đây từ đầu trang, chỉ tốn có 3 giây). Nếu thấy có thêm ý tưởng hay có gì muốn góp ý, các bạn hãy comment phía bên dưới nhé!!\n","wordCount":"842","inLanguage":"en","datePublished":"2022-04-28T17:00:00Z","dateModified":"2022-04-28T17:00:00Z","author":{"@type":"Person","name":"iamqh"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://iamqh.github.io/posts/crawl-truy-n-va-mang-no-len-kindle/"},"publisher":{"@type":"Organization","name":"iamqh's Blog","logo":{"@type":"ImageObject","url":"https://iamqh.github.io/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://iamqh.github.io accesskey=h title="iamqh's Blog (Alt + H)">
<img src=https://iamqh.github.io/logo.png alt=logo aria-label=logo height=30>iamqh's Blog</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://iamqh.github.io/archives/ title=Archive>
<span>Archive</span>
</a>
</li>
<li>
<a href=https://iamqh.github.io/everyday/ title=Everyday>
<span>Everyday</span>
</a>
</li>
<li>
<a href=https://iamqh.github.io/about/ title=About>
<span>About</span>
</a>
</li>
<li>
<a href=https://iamqh.github.io/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
</ul>
</nav>
</header>
<main class="main page">
<article class=post-single>
<header class=post-header>
<div class=breadcrumbs><a href=https://iamqh.github.io>Home</a>&nbsp;»&nbsp;<a href=https://iamqh.github.io/posts/>Posts</a></div>
<h1 class=post-title>
Crawl truyện và mang nó lên Kindle
</h1>
<div class=post-meta><span><img src="https://visitor-badge-reloaded.herokuapp.com/badge?page_id=iamqh./posts/crawl-truy-n-va-mang-no-len-kindle/&style=flat-square&text=Read"></span>&nbsp;·&nbsp;<span title="2022-04-28 17:00:00 +0000 UTC">April 28, 2022</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;iamqh
</div>
</header> <aside id=toc-container class="toc-container wide">
<div class=toc>
<details open>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#crawl-data aria-label="Crawl data">Crawl data</a></li>
<li>
<a href=#t%e1%ba%a1o-ebook aria-label="Tạo ebook">Tạo ebook</a></li>
<li>
<a href=#k%e1%ba%bft aria-label=Kết>Kết</a>
</li>
</ul>
</div>
</details>
</div>
</aside>
<script>let activeElement,elements;window.addEventListener('DOMContentLoaded',function(b){checkTocPosition(),elements=document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]'),activeElement=elements[0];const a=encodeURI(activeElement.getAttribute('id')).toLowerCase();document.querySelector(`.inner ul li a[href="#${a}"]`).classList.add('active')},!1),window.addEventListener('resize',function(a){checkTocPosition()},!1),window.addEventListener('scroll',()=>{activeElement=Array.from(elements).find(a=>{if(getOffsetTop(a)-window.pageYOffset>0&&getOffsetTop(a)-window.pageYOffset<window.innerHeight/2)return a})||activeElement,elements.forEach(a=>{const b=encodeURI(a.getAttribute('id')).toLowerCase();a===activeElement?document.querySelector(`.inner ul li a[href="#${b}"]`).classList.add('active'):document.querySelector(`.inner ul li a[href="#${b}"]`).classList.remove('active')})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue('--gap'),10);function checkTocPosition(){const a=document.body.scrollWidth;a-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(a){if(!a.getClientRects().length)return 0;let b=a.getBoundingClientRect(),c=a.ownerDocument.defaultView;return b.top+c.pageYOffset}</script>
<div class=post-content>
<p>Chuyện là đợt dính covid vừa rồi phải cách ly một mình một cõi, mình mới nhận ra là mình còn sở hữu một em kindle paper white đời thứ 3 vẫn còn ngon. Hồi đấy mua về để đọc truyện mà sau lại lười quá, vứt xó rồi quên luôn <i class="em em-sweat_smile"></i>. Cách ly chán quá, nên mình có thời gian đọc cày xong <strong>Kimetsu no yaiba</strong> luôn. Rảnh thật đấy <i class="em em-relieved"></i>. Mấy hôm nay thì mình có đọc tiếp Conan, bác tác giả ra chap mới lâu thiệt chứ. Thế là tình cờ phát hiện ra một trang truyện dịch lại những quyển tiêu thuyết (không phải là manga nha). Cơ mà đọc trên kindle quen rồi, đọc trên máy điện thoại hay tablet mình thấy khó tập trung hơn. Nên mình quyết định thử chuyển mấy cuốn truyện đó lên Kindle được hay không!</p>
<h1 id=crawl-data>Crawl data<a hidden class=anchor aria-hidden=true href=#crawl-data>#</a></h1>
<p>Okay, let&rsquo;s start! Trước hết thì trang web mình tìm được là <a href=https://truyendich.com/tieu-thuyet-conan-ban-giao-huong-cua-ke-sat-nhan>Truyện dịch</a>. Như các bạn đã thấy, trang web đã có đầy đủ các thông tin cơ bản của 1 ebook như cover, tác giả, lời giới thiệu và mục lục.</p>
<p>Bây giờ chúng ta cùng vào xem thử một chương của tiểu thuyết xem sao. May quá, toàn bộ đều chỉ là html bình thường, không phải load js gì cả. Vậy thì việc crawl data sẽ không gặp khó khăn gì cả! Mình sẽ sử dụng python kết hợp với lxml để crawl thôi. Sau khi trích xuất được content của từng chapter, mình sẽ lưu nó lại thành từng file <code>markdown</code> tương ứng với từng chapter. Còn tại sao lại là markdown thì phần sau sẽ rõ</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>_getChapter</span>(self, number: int, url: str):
  file_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;chapter-</span><span style=color:#e6db74>{0}</span><span style=color:#e6db74>.md&#39;</span><span style=color:#f92672>.</span>format(number)
  html_text <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>session<span style=color:#f92672>.</span>get(url)<span style=color:#f92672>.</span>text
  tree <span style=color:#f92672>=</span> etree<span style=color:#f92672>.</span>HTML(html_text)
  content_node <span style=color:#f92672>=</span> tree<span style=color:#f92672>.</span>xpath(<span style=color:#e6db74>&#39;//div[@id=&#34;read-content&#34;]&#39;</span>)[<span style=color:#ae81ff>0</span>]
  chapter_html <span style=color:#f92672>=</span> etree<span style=color:#f92672>.</span>tostring(content_node)
  file <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(self<span style=color:#f92672>.</span>save_path, file_name)
  <span style=color:#66d9ef>with</span> open(file, <span style=color:#e6db74>&#34;w&#34;</span>, encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;utf-8&#39;</span>) <span style=color:#66d9ef>as</span> text_file:
  markdown_text <span style=color:#f92672>=</span> md(chapter_html)
  markdown_text <span style=color:#f92672>=</span> markdown_text<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39; - &#39;</span>, <span style=color:#e6db74>&#39; \- &#39;</span>)
  text_file<span style=color:#f92672>.</span>write(markdown_text)
</code></pre></div><h1 id=tạo-ebook>Tạo ebook<a hidden class=anchor aria-hidden=true href=#tạo-ebook>#</a></h1>
<p>Mình rất là khó chịu với việc đọc phải ebook nào mà không có mục lục, khi đó để xem mình đang đọc đến đâu hoặc là chọn nhanh 1 chương là gần như không thể. Vì vậy mình tách mỗi chapter thành 1 file markdown, và dùng MarkdownPP để gắn chúng lại với nhau.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#66d9ef>with</span> open(input_name, <span style=color:#e6db74>&#39;w&#39;</span>, encoding<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;utf-8&#39;</span>) <span style=color:#66d9ef>as</span> template:
	template<span style=color:#f92672>.</span>writelines([<span style=color:#e6db74>&#39;% </span><span style=color:#e6db74>{0}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(novel<span style=color:#f92672>.</span>title),<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#39;</span>, <span style=color:#e6db74>&#39;% </span><span style=color:#e6db74>{0}</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(novel<span style=color:#f92672>.</span>author), <span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>&#39;</span>])
    <span style=color:#66d9ef>for</span> chapter <span style=color:#f92672>in</span> chapters:
    	template<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#39;## </span><span style=color:#e6db74>{0}</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(chapter<span style=color:#f92672>.</span>title))
        template<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#39;!INCLUDE &#34;</span><span style=color:#e6db74>{0}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>{1}</span><span style=color:#e6db74>&#34;, 1</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>&#39;</span><span style=color:#f92672>.</span>format(self<span style=color:#f92672>.</span>save_path, chapter<span style=color:#f92672>.</span>file_name))
    template<span style=color:#f92672>.</span>close()
    input <span style=color:#f92672>=</span> open(input_name, <span style=color:#e6db74>&#39;r&#39;</span>)
    output <span style=color:#f92672>=</span> open(output_name, <span style=color:#e6db74>&#39;w&#39;</span>)
    MarkdownPP<span style=color:#f92672>.</span>MarkdownPP(input<span style=color:#f92672>=</span>input, output<span style=color:#f92672>=</span>output, modules<span style=color:#f92672>=</span>list(MarkdownPP<span style=color:#f92672>.</span>modules))
    input<span style=color:#f92672>.</span>close()
    output<span style=color:#f92672>.</span>close()
</code></pre></div><p>Như các bạn thấy ở trên, trc khi thêm từng chapter, mình đều để 1 heading, điều này sẽ giúp chúng ta dễ dàng trong bước tạo ebook này.</p>
<p>Okay, vậy là đã tạo được 1 ebook &ldquo;tạm đọc được&rdquo;. Giờ mình sẽ dùng pandoc để chuyển markdown sang ebook định dạng epub.</p>
<p>Làm cái này mình mới nhận ra là làm ebook cũng style bằng css. Tất nhiên là nó không đến mức phức tạp như web, chỉ là style 1 vài tag cơ bản thôi. Ví dụ như style dưới đây</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css>    <span style=color:#f92672>body</span> { <span style=color:#66d9ef>font-family</span>: Georgia,<span style=color:#e6db74>&#34;Times New Roman&#34;</span>,Times; <span style=color:#66d9ef>margin</span>: <span style=color:#ae81ff>5</span><span style=color:#66d9ef>%</span>; <span style=color:#66d9ef>text-align</span>: <span style=color:#66d9ef>justify</span>; <span style=color:#66d9ef>font-size</span>: <span style=color:#66d9ef>medium</span>; }
    <span style=color:#f92672>code</span> { <span style=color:#66d9ef>font-family</span>: <span style=color:#66d9ef>monospace</span>; }
    <span style=color:#f92672>section</span> <span style=color:#f92672>h1</span> { <span style=color:#66d9ef>text-align</span>: <span style=color:#66d9ef>left</span>; <span style=color:#66d9ef>font-size</span>: <span style=color:#ae81ff>4.5</span><span style=color:#66d9ef>em</span>; <span style=color:#66d9ef>font-weight</span>: <span style=color:#66d9ef>bold</span>; <span style=color:#66d9ef>margin-bottom</span>: <span style=color:#ae81ff>0</span>; <span style=color:#66d9ef>padding-bottom</span>: <span style=color:#ae81ff>0</span>; <span style=color:#66d9ef>font-style</span>: <span style=color:#66d9ef>italic</span>; }
    <span style=color:#f92672>h1</span> <span style=color:#f92672>+</span> <span style=color:#f92672>p</span> { <span style=color:#66d9ef>margin-top</span>: <span style=color:#ae81ff>0</span>; <span style=color:#66d9ef>padding-top</span>: <span style=color:#ae81ff>0</span>; }
    <span style=color:#f92672>h2</span> { <span style=color:#66d9ef>text-align</span>: <span style=color:#66d9ef>left</span>; <span style=color:#66d9ef>font-size</span>: <span style=color:#ae81ff>1.5</span><span style=color:#66d9ef>em</span>; }
    <span style=color:#f92672>h3</span> { <span style=color:#66d9ef>text-align</span>: <span style=color:#66d9ef>left</span>; <span style=color:#66d9ef>font-size</span>: <span style=color:#ae81ff>1</span><span style=color:#66d9ef>em</span>; <span style=color:#66d9ef>font-weight</span>: <span style=color:#66d9ef>bold</span>; }
    <span style=color:#f92672>h4</span> { <span style=color:#66d9ef>text-align</span>: <span style=color:#66d9ef>left</span>; }
    <span style=color:#f92672>h5</span> { <span style=color:#66d9ef>text-align</span>: <span style=color:#66d9ef>left</span>; }
    <span style=color:#f92672>h6</span> { <span style=color:#66d9ef>text-align</span>: <span style=color:#66d9ef>left</span>; }
    <span style=color:#f92672>h1</span>.<span style=color:#a6e22e>title</span> { <span style=color:#66d9ef>text-align</span>: <span style=color:#66d9ef>left</span>; <span style=color:#66d9ef>font-size</span>: <span style=color:#ae81ff>2</span><span style=color:#66d9ef>em</span>; <span style=color:#66d9ef>margin-top</span>: <span style=color:#ae81ff>50</span><span style=color:#66d9ef>%</span>; }
    <span style=color:#f92672>h2</span>.<span style=color:#a6e22e>author</span> { <span style=color:#66d9ef>font-size</span>: <span style=color:#ae81ff>1.3</span><span style=color:#66d9ef>em</span>; }
    <span style=color:#f92672>h3</span>.<span style=color:#a6e22e>date</span> { }
    <span style=color:#f92672>div</span>.<span style=color:#a6e22e>title</span> <span style=color:#f92672>h1</span> { <span style=color:#66d9ef>text-align</span>: <span style=color:#66d9ef>left</span>; <span style=color:#66d9ef>font-size</span>: <span style=color:#ae81ff>2</span><span style=color:#66d9ef>em</span>; <span style=color:#66d9ef>margin-top</span>: <span style=color:#ae81ff>50</span><span style=color:#66d9ef>%</span>; }
    <span style=color:#f92672>ol</span>.<span style=color:#a6e22e>toc</span> { <span style=color:#66d9ef>padding</span>: <span style=color:#ae81ff>0</span>; <span style=color:#66d9ef>margin-left</span>: <span style=color:#ae81ff>1</span><span style=color:#66d9ef>em</span>; }
    <span style=color:#f92672>ol</span>.<span style=color:#a6e22e>toc</span> <span style=color:#f92672>li</span> { <span style=color:#66d9ef>list-style-type</span>: <span style=color:#66d9ef>none</span>; <span style=color:#66d9ef>margin</span>: <span style=color:#ae81ff>0</span>; <span style=color:#66d9ef>padding</span>: <span style=color:#ae81ff>0</span>; }
    <span style=color:#f92672>hr</span> { <span style=color:#66d9ef>border</span>: <span style=color:#66d9ef>none</span>; <span style=color:#66d9ef>text-align</span>: <span style=color:#66d9ef>center</span>; }
    <span style=color:#f92672>hr</span>:<span style=color:#a6e22e>after</span> { <span style=color:#66d9ef>content</span>: <span style=color:#e6db74>&#39;* * *&#39;</span>; }
    #toc <span style=color:#f92672>&gt;</span> <span style=color:#f92672>ol</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>li</span> <span style=color:#f92672>&gt;</span> <span style=color:#f92672>a</span> { <span style=color:#66d9ef>display</span>: <span style=color:#66d9ef>none</span>; }
    #the-night-alphabet <span style=color:#f92672>blockquote</span> { <span style=color:#66d9ef>margin-top</span>: <span style=color:#ae81ff>50</span><span style=color:#66d9ef>%</span>; <span style=color:#66d9ef>font-style</span>: <span style=color:#66d9ef>italic</span>; }
    #the-night-alphabet <span style=color:#f92672>h1</span> { <span style=color:#66d9ef>text-align</span>: <span style=color:#66d9ef>center</span>; <span style=color:#66d9ef>font-size</span>: <span style=color:#ae81ff>4</span><span style=color:#66d9ef>em</span>; <span style=color:#66d9ef>page-break-after</span>: <span style=color:#66d9ef>always</span>; }
</code></pre></div><p>Sau khi style xong thì mình build ebook thôi</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>output <span style=color:#f92672>=</span> open(output_name, <span style=color:#e6db74>&#39;r&#39;</span>)
doc <span style=color:#f92672>=</span> pandoc<span style=color:#f92672>.</span>read(file<span style=color:#f92672>=</span>output)
pandoc<span style=color:#f92672>.</span>write(doc<span style=color:#f92672>=</span>doc, file<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{0}</span><span style=color:#e6db74>.epub&#39;</span><span style=color:#f92672>.</span>format(slug), format<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;epub&#39;</span>, options<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;--css=style.css&#39;</span>])
output<span style=color:#f92672>.</span>close()
</code></pre></div><p>Cuối cùng là vứt nó lên kindle bằng cách gửi qua mail mình đã đăng kí. Và đây là thành quả</p>
<p><img loading=lazy src=https://i.imgur.com/ofncrv2.jpeg alt>
</p>
<h1 id=kết>Kết<a hidden class=anchor aria-hidden=true href=#kết>#</a></h1>
<p>Đây là toàn bộ source code mà mình đã dùng để crawl và chuyển sang epub. Các bạn có thể tham khảo tại <a href=https://github.com/HoaPham98/truyen-dich-to-ebook>repo này</a>.</p>
<p>Còn rất nhiều điều có thể làm tiếp tại dự án này, như là thêm ảnh cover cho ebook, tạo extension cho chrome để có thể download trực tiếp từ trang web hoặc tạo 1 con web riêng để mọi người có thể điền link vào và tải về, vân vân và mây mây&mldr;</p>
<p>Xin cảm ơn các bạn đã kiên nhẫn đọc đến tận đây (tui nói vậy thôi chứ tui biết bạn scroll xuống đây từ đầu trang, chỉ tốn có 3 giây). Nếu thấy có thêm ý tưởng hay có gì muốn góp ý, các bạn hãy comment phía bên dưới nhé!!</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://iamqh.github.io/tags/python/>python</a></li>
<li><a href=https://iamqh.github.io/tags/crawl/>crawl</a></li>
</ul>
<nav class=paginav>
<a class=next href=https://iamqh.github.io/posts/comment-story/>
<span class=title>Next Page »</span>
<br>
<span>Chuyện comment, mộng mơ và cái sự lười</span>
</a>
</nav>
<div class=share-buttons>
<a target=_blank rel="noopener noreferrer" aria-label="share Crawl truyện và mang nó lên Kindle on twitter" href="https://twitter.com/intent/tweet/?text=Crawl%20truy%e1%bb%87n%20v%c3%a0%20mang%20n%c3%b3%20l%c3%aan%20Kindle&url=https%3a%2f%2fiamqh.github.io%2fposts%2fcrawl-truy-n-va-mang-no-len-kindle%2f&hashtags=python%2ccrawl"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Crawl truyện và mang nó lên Kindle on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fiamqh.github.io%2fposts%2fcrawl-truy-n-va-mang-no-len-kindle%2f&title=Crawl%20truy%e1%bb%87n%20v%c3%a0%20mang%20n%c3%b3%20l%c3%aan%20Kindle&summary=Crawl%20truy%e1%bb%87n%20v%c3%a0%20mang%20n%c3%b3%20l%c3%aan%20Kindle&source=https%3a%2f%2fiamqh.github.io%2fposts%2fcrawl-truy-n-va-mang-no-len-kindle%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Crawl truyện và mang nó lên Kindle on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fiamqh.github.io%2fposts%2fcrawl-truy-n-va-mang-no-len-kindle%2f&title=Crawl%20truy%e1%bb%87n%20v%c3%a0%20mang%20n%c3%b3%20l%c3%aan%20Kindle"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Crawl truyện và mang nó lên Kindle on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fiamqh.github.io%2fposts%2fcrawl-truy-n-va-mang-no-len-kindle%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Crawl truyện và mang nó lên Kindle on whatsapp" href="https://api.whatsapp.com/send?text=Crawl%20truy%e1%bb%87n%20v%c3%a0%20mang%20n%c3%b3%20l%c3%aan%20Kindle%20-%20https%3a%2f%2fiamqh.github.io%2fposts%2fcrawl-truy-n-va-mang-no-len-kindle%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg>
</a>
<a target=_blank rel="noopener noreferrer" aria-label="share Crawl truyện và mang nó lên Kindle on telegram" href="https://telegram.me/share/url?text=Crawl%20truy%e1%bb%87n%20v%c3%a0%20mang%20n%c3%b3%20l%c3%aan%20Kindle&url=https%3a%2f%2fiamqh.github.io%2fposts%2fcrawl-truy-n-va-mang-no-len-kindle%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg>
</a>
</div>
</footer><div class=comments>
<div id=comment-loading class=loading></div>
<div id=login-box class=login>
Bạn nghĩ như thế nào về bài viết này?<br><button onclick=login()>Tham gia bình luận</button>
<div class=copyright>Chức năng này cần liên kết với tài khoản Google<br>Nếu không thích thì có thể comment
<button onclick=goninja()>Nặc danh</button>
</div>
</div>
<div id=comment-box class=comment-input>
<div class=avatar>
<img id=user-avatar src width=32 height=32>
</div>
<div class=input>
<textarea id=comment-content onkeyup=autoSizing(this) onkeydown=submitComment(event) placeholder="Comment gõ vào đây :D"></textarea>
<span>Gõ xong nhấn <code>Ctrl</code> + <code>Enter</code> để gửi. Bạn không thể xóa comment sau khi gửi.</span>
<button id=comment-button onclick=submitData()>Gửi</button>
</div>
</div>
<ul id=comment-list class=comment-list></ul>
</div>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jQuery-linkify/2.1.9/linkify.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jQuery-linkify/2.1.9/linkify-jquery.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/jQuery-linkify/2.1.9/linkify-html.min.js integrity="sha512-utRbYaR9KdGo5zyscXAOomJjy8nOGc4IhDcCO4NjrkpXE14lmkvnC0TPrsRXfk+EIvf2cEMXQI2jEpSNh/jGvA==" crossorigin=anonymous></script>
<script src=https://www.gstatic.com/firebasejs/8.5.0/firebase-app.js></script>
<script src=https://www.gstatic.com/firebasejs/8.5.0/firebase-analytics.js></script>
<script src=https://www.gstatic.com/firebasejs/8.5.0/firebase-auth.js></script>
<script src=https://www.gstatic.com/firebasejs/8.5.0/firebase-firestore.js></script>
<script>let postSlug="Page(/posts/crawl-truy-n-va-mang-no-len-kindle.md)".match(/[^\/]+$/g).pop().replace(".md)","")</script>
<script>var firebaseConfig={apiKey:"AIzaSyDSOP8BJBidyNm2L_VYuz_zkWxXoNNQENE",authDomain:"iamqh-2d10b.firebaseapp.com",projectId:"iamqh-2d10b",storageBucket:"iamqh-2d10b.appspot.com",messagingSenderId:"172572963962",appId:"1:172572963962:web:c4611bebbaefeaf38537c3",measurementId:"G-MR4X23L858"},provider,auth,currentUser,db,updateAuth,login,goninja,encodeHTML,saveNewComment,submitData,submitComment,filterNewlineInComment,filterURLinComment,addNewComment;firebase.initializeApp(firebaseConfig),provider=new firebase.auth.GoogleAuthProvider,auth=firebase.auth(),currentUser=null,db=firebase.firestore(),updateAuth=function(a){document.getElementById("comment-loading").style.display="none",a?(currentUser=a,document.getElementById("login-box").style.display="none",document.getElementById("comment-box").style.display="flex",document.getElementById("user-avatar").setAttribute("src",a.photoURL)):(document.getElementById("comment-box").style.display="none",document.getElementById("login-box").style.display="block")},auth.onAuthStateChanged(function(a){updateAuth(a)}),login=function(){auth.signInWithPopup(provider).then(function(a){}).catch(function(a){})},goninja=function(){updateAuth({displayName:"Không Tên",photoURL:"https://i.imgur.com/03lrXKb.png"})},encodeHTML=function(a){return a.replace(/</g,'&lt;').replace(/"/g,'&quot;').replace(/>/g,'&gt;')},saveNewComment=function(b){if(!currentUser)return;var a={username:currentUser.displayName,avatar:currentUser.photoURL,post_time:~~((new Date).getTime()/1e3),message:encodeHTML(b),slug:postSlug};db.collection("comments").add(a).then(()=>{addNewComment(a.username,a.avatar,a.post_time,a.message)}),document.getElementById("comment-content").value=""};function debounce(b,d,c){var a;return function(){var e=this,f=arguments,g=function(){a=null,c||b.apply(e,f)},h=c&&!a;clearTimeout(a),a=setTimeout(g,d),h&&b.apply(e,f)}}submitData=debounce(function(){var a=document.getElementById("comment-content").value;a.length&&saveNewComment(a)},250),submitComment=function(a){var b=a.which||a.keyCode,c=a.ctrlKey||a.metaKey;b===13&&c&&submitData()},filterNewlineInComment=function(a){return a.replace(/\n/g,"<br/>")},filterURLinComment=function(a){return a.replace(/(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9]\.[^\s]{2,})/g,"<a target='_blank' rel='noopener noreferrer' href='$1'>$1</a>")},addNewComment=function(d,e,i,f){var a=encodeHTML(f),c,g,h,b;a=filterNewlineInComment(linkifyHtml(a)),c=new Date(i*1e3),g=c.toLocaleTimeString()+' '+c.toLocaleDateString(),h='<div class="avatar">   <img src="'+e+'"/>'+' </div>'+'<div class="comment tex2jax_ignore">'+'  <div class="metadata"><b>'+encodeHTML(d)+'</b> lúc <span>'+g+'</span></div>'+'  <div class="content">'+a,'  </div></div>',b=document.createElement('li'),b.innerHTML=h,document.getElementById("comment-list").append(b)},db.collection("comments").where("slug","==",postSlug).get().then(a=>{if(a){let b=[];a.forEach(a=>{b.push(a.data())}),b.sort((a,b)=>a.post_time-b.post_time);for(let c=0;c<b.length;c++){let a=b[c];addNewComment(a.username,a.avatar,a.post_time,a.message)}}})</script>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://iamqh.github.io>iamqh's Blog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>